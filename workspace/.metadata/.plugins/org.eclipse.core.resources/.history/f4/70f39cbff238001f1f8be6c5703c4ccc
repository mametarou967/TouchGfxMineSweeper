#include <gui/gamescreen1_screen/GameScreen1View.hpp>
#include <gui/gamescreen1_screen/GameScreen1Presenter.hpp>
#include <gui/model/Model.hpp>

GameScreen1Presenter::GameScreen1Presenter(GameScreen1View& v)
    : view(v)
{

}

void GameScreen1Presenter::activate()
{
	model = Model();

}

void GameScreen1Presenter::deactivate()
{

}

void GameScreen1Presenter::blockClicked(int row, int column)
{
	// 現在の状態を保存
	model.saveCurrentBlockMatrix();

	// 入力による状態の変更

	// 現在の状態と変化後の状態の比較
	for(int row=0;row<model.getRowMax();row++)
	{
		for(int column=0;row<model.getColumnMax();column++)
		{
			if(model.diffPresentBlock(row,column))
			{
				view.updateBlockImage(row, column, GetBlockState(model->getBlock(row,column)));
			}
		}
	}

}


BlockState GameScreen1Presenter::GetBlockState(Model::Block block)
{
	if(!block.isOpen)
	{
		if(!block.hasFlag) return Close;
		else return CloseWithFlag;
	}
	else
	{
		if(block.hasBomb) return OpenBomb;
		switch(block.number)
		{
		case 0: return OpenNumber0;
		case 1: return OpenNumber1;
		case 2: return OpenNumber2;
		case 3: return OpenNumber3;
		case 4: return OpenNumber4;
		case 5: return OpenNumber5;
		case 6: return OpenNumber6;
		case 7: return OpenNumber7;
		case 8: return OpenNumber8;
		case 9: return OpenNumber9;
		default: return OpenNumber0;
		}
	}
}
